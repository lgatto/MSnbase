<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Peak Detection for 'MSnExp' or 'Spectrum' instances — pickPeaks-methods • MSnbase</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Peak Detection for 'MSnExp' or 'Spectrum' instances — pickPeaks-methods"><meta name="description" content="This method performs a peak picking on individual spectra
  (Spectrum instances) or whole experiments (MSnExp instances) to
  create centroided spectra.
  For noisy spectra there are currently two different noise estimators
  available, the Median Absolute Deviation (method = &quot;MAD&quot;) and
  Friedman's Super Smoother (method = &quot;SuperSmoother&quot;),
  as implemented in the MALDIquant::detectPeaks and
  MALDIquant::estimateNoise functions respectively.
The method supports also to optionally refine the m/z value of
  the identified centroids by considering data points that belong (most
  likely) to the same mass peak. The m/z value is calculated as an
  intensity weighted average of the m/z values within the peak region.
  How the peak region is defined depends on the method chosen:
refineMz = &quot;kNeighbors&quot;: m/z values (and their respective
  intensities) of the2 * k closest signals to the centroid are
  used in the intensity weighted average calculation. The number of
  neighboring signals can be defined with the argument k.
refineMz = &quot;descendPeak&quot;: the peak region is defined by
  descending from the identified centroid/peak on both sides until the
  measured signal increases again. Within this defined region all
  measurements with an intensity of at least signalPercentage of
  the centroid's intensity are used to calculate the refined m/z. By
  default the descend is stopped when the first signal that is equal or
  larger than the last observed one is encountered. Setting
  stopAtTwo = TRUE, two consecutively increasing signals are
  required.
By default (refineMz = &quot;none&quot;, simply the m/z of the largest
  signal (the identified centroid) is reported. See below for examples."><meta property="og:description" content="This method performs a peak picking on individual spectra
  (Spectrum instances) or whole experiments (MSnExp instances) to
  create centroided spectra.
  For noisy spectra there are currently two different noise estimators
  available, the Median Absolute Deviation (method = &quot;MAD&quot;) and
  Friedman's Super Smoother (method = &quot;SuperSmoother&quot;),
  as implemented in the MALDIquant::detectPeaks and
  MALDIquant::estimateNoise functions respectively.
The method supports also to optionally refine the m/z value of
  the identified centroids by considering data points that belong (most
  likely) to the same mass peak. The m/z value is calculated as an
  intensity weighted average of the m/z values within the peak region.
  How the peak region is defined depends on the method chosen:
refineMz = &quot;kNeighbors&quot;: m/z values (and their respective
  intensities) of the2 * k closest signals to the centroid are
  used in the intensity weighted average calculation. The number of
  neighboring signals can be defined with the argument k.
refineMz = &quot;descendPeak&quot;: the peak region is defined by
  descending from the identified centroid/peak on both sides until the
  measured signal increases again. Within this defined region all
  measurements with an intensity of at least signalPercentage of
  the centroid's intensity are used to calculate the refined m/z. By
  default the descend is stopped when the first signal that is equal or
  larger than the last observed one is encountered. Setting
  stopAtTwo = TRUE, two consecutively increasing signals are
  required.
By default (refineMz = &quot;none&quot;, simply the m/z of the largest
  signal (the identified centroid) is reported. See below for examples."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">MSnbase</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.35.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles"><li><a class="dropdown-item" href="../articles/v01-MSnbase-demo.html">MSnbase: MS data processing, visualisation and quantification</a></li>
    <li><a class="dropdown-item" href="../articles/v02-MSnbase-io.html">MSnbase IO capabilities</a></li>
    <li><a class="dropdown-item" href="../articles/v03-MSnbase-centroiding.html">MSnbase: centroiding of profile-mode MS data</a></li>
    <li><a class="dropdown-item" href="../articles/v04-benchmarking.html">MSnbase benchmarking</a></li>
    <li><a class="dropdown-item" href="../articles/v05-MSnbase-development.html">A short introduction to *MSnbase* development</a></li>
  </ul></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/lgatto/MSnbase/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Peak Detection for 'MSnExp' or 'Spectrum' instances</h1>

      <div class="d-none name"><code>pickPeaks-method.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This method performs a peak picking on individual spectra
  (<code>Spectrum</code> instances) or whole experiments (<code>MSnExp</code> instances) to
  create centroided spectra.
  For noisy spectra there are currently two different noise estimators
  available, the Median Absolute Deviation (<code>method = "MAD"</code>) and
  Friedman's Super Smoother (<code>method = "SuperSmoother"</code>),
  as implemented in the <code><a href="https://rdrr.io/pkg/MALDIquant/man/detectPeaks-methods.html" class="external-link">MALDIquant::detectPeaks</a></code> and
  <code><a href="https://rdrr.io/pkg/MALDIquant/man/estimateNoise-methods.html" class="external-link">MALDIquant::estimateNoise</a></code> functions respectively.</p>
<p>The method supports also to optionally <em>refine</em> the m/z value of
  the identified centroids by considering data points that belong (most
  likely) to the same mass peak. The m/z value is calculated as an
  intensity weighted average of the m/z values within the peak region.
  How the peak region is defined depends on the method chosen:</p>
<p><code>refineMz = "kNeighbors"</code>: m/z values (and their respective
  intensities) of the<code>2 * k</code> closest signals to the centroid are
  used in the intensity weighted average calculation. The number of
  neighboring signals can be defined with the argument <code>k</code>.</p>
<p><code>refineMz = "descendPeak"</code>: the peak region is defined by
  descending from the identified centroid/peak on both sides until the
  measured signal increases again. Within this defined region all
  measurements with an intensity of at least <code>signalPercentage</code> of
  the centroid's intensity are used to calculate the refined m/z. By
  default the descend is stopped when the first signal that is equal or
  larger than the last observed one is encountered. Setting
  <code>stopAtTwo = TRUE</code>, two consecutively increasing signals are
  required.</p>
<p>By default (<code>refineMz = "none"</code>, simply the m/z of the largest
  signal (the identified centroid) is reported. See below for examples.</p>
    </div>


    <div class="section level2">
    <h2 id="methods">Methods<a class="anchor" aria-label="anchor" href="#methods"></a></h2>
    <p></p><dl><dt><code>signature(x = "MSnExp", halfWindowSize = "integer",
        method = "character", SNR = "numeric", verbose = "logical",
	refineMz = "character", ...)</code></dt>
<dd><p>Performs the peak picking for all spectra in an <code>MSnExp</code> instance.
      <code>method</code> could be <code>"MAD"</code> or <code>"SuperSmoother"</code>.
      <code>halfWindowSize</code> controls the window size of the peak picking
      algorithm. The resulting window size is <code>2 * halfWindowSize + 1</code>.
      The size should be nearly (or slightly larger) the <em>FWHM</em>
      (full width at half maximum).
      A local maximum is considered as peak if its intensity is <code>SNR</code>
      times larger than the estimated noise.
      <code>refineMz</code> allows to choose a method for an optional centroid
      m/z refinement (see description for more details). Choises are
      <code>"none"</code> (default, no m/z refinement), <code>"kNeighbors"</code>
      and <code>"descendPeak"</code>.
      The arguments <code>...</code> are passed to the noise estimator or
      m/z refinement functions.
      For the noise estimator functions, currenlty only the
      <code>method = "SuperSmoother"</code> accepts additional arguments,
      e.g.  <code>span</code>. Please see <code><a href="https://rdrr.io/r/stats/supsmu.html" class="external-link">supsmu</a></code> for
      details. <code>refineMethod = "kNeighbors"</code> supports additional
      argument <code>k</code> and <code>refineMethod = "descendPeak"</code>
      arguments <code>signalPercentage</code> and <code>stopAtTwo</code>. See
      description above for more details.</p>
<p>This method displays a progress bar if <code>verbose = TRUE</code>.
      Returns an <code>MSnExp</code> instance with centroided spectra.</p></dd>

    <dt><code>signature(x = "Spectrum", method = "character",
        halfWindowSize = "integer", ...)</code></dt>
<dd><p>Performs the peak picking for the spectrum (<code>Spectrum</code> instance).
      This method is the same as above but returns a centroided <code>Spectrum</code>
      instead of an <code>MSnExp</code> object. It has no <code>verbose</code> argument.
      Please read the details for the above <code>MSnExp</code> method.</p></dd>


</dl></div>
    <div class="section level2">
    <h2 id="author">Author<a class="anchor" aria-label="anchor" href="#author"></a></h2>
    <p>Sebastian Gibb &lt;mail@sebastiangibb.de&gt; with contributions from
  Johannes Rainer.</p>
    </div>
    <div class="section level2">
    <h2 id="see-also">See also<a class="anchor" aria-label="anchor" href="#see-also"></a></h2>
    <div class="dont-index"><p><code><a href="clean-methods.html">clean</a></code>, <code><a href="removePeaks-methods.html">removePeaks</a></code> <code><a href="smooth-methods.html">smooth</a></code>,
  <code><a href="estimateNoise-method.html">estimateNoise</a></code> and <code><a href="trimMz-methods.html">trimMz</a></code> for other spectra
  processing methods.</p></div>
    </div>
    <div class="section level2">
    <h2 id="references">References<a class="anchor" aria-label="anchor" href="#references"></a></h2>
    <p>S. Gibb and K. Strimmer. 2012.
MALDIquant: a versatile R package for the analysis of mass spectrometry data.
Bioinformatics 28: 2270-2271.
<a href="http://strimmerlab.org/software/maldiquant/" class="external-link">http://strimmerlab.org/software/maldiquant/</a></p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"Spectrum1"</span>,</span></span>
<span class="r-in"><span>           intensity <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">6</span>, <span class="fl">5</span><span class="op">:</span><span class="fl">1</span><span class="op">)</span>,</span></span>
<span class="r-in"><span>           mz <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">11</span>,</span></span>
<span class="r-in"><span>           centroided <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sp2</span> <span class="op">&lt;-</span> <span class="fu">pickPeaks</span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> unable to find an inherited method for function ‘pickPeaks’ for signature ‘object = "Spectrum1"’</span>
<span class="r-in"><span><span class="fu"><a href="Spectrum-class.html">intensity</a></span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'object' in selecting a method for function 'intensity': object 'sp2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">itraqdata</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">itraqdata2</span> <span class="op">&lt;-</span> <span class="fu">pickPeaks</span><span class="op">(</span><span class="va">itraqdata</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> unable to find an inherited method for function ‘pickPeaks’ for signature ‘object = "MSnExp"’</span>
<span class="r-in"><span><span class="fu"><a href="pSet-class.html">processingData</a></span><span class="op">(</span><span class="va">itraqdata2</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'object' in selecting a method for function 'processingData': object 'itraqdata2' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Examples for refineMz:</span></span></span>
<span class="r-in"><span><span class="va">ints</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">5</span>, <span class="fl">3</span>, <span class="fl">2</span>, <span class="fl">3</span>, <span class="fl">1</span>, <span class="fl">2</span>, <span class="fl">4</span>, <span class="fl">6</span>, <span class="fl">8</span>, <span class="fl">11</span>, <span class="fl">4</span>, <span class="fl">7</span>, <span class="fl">5</span>, <span class="fl">2</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">0</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">1</span>, <span class="fl">0</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">mzs</span> <span class="op">&lt;-</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="pSet-class.html">length</a></span><span class="op">(</span><span class="va">ints</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">sp1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/methods/new.html" class="external-link">new</a></span><span class="op">(</span><span class="st">"Spectrum1"</span>, intensity <span class="op">=</span> <span class="va">ints</span>, mz <span class="op">=</span> <span class="va">mzs</span>, centroided <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot-methods.html">plot</a></span><span class="op">(</span><span class="fu"><a href="Spectrum-class.html">mz</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span>, <span class="fu"><a href="Spectrum-class.html">intensity</a></span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"h"</span><span class="op">)</span></span></span>
<span class="r-plt img"><img src="pickPeaks-method-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Without m/z refinement:</span></span></span>
<span class="r-in"><span><span class="va">sp2</span> <span class="op">&lt;-</span> <span class="fu">pickPeaks</span><span class="op">(</span><span class="va">sp1</span><span class="op">)</span>           </span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> unable to find an inherited method for function ‘pickPeaks’ for signature ‘object = "Spectrum1"’</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="Spectrum-class.html">mz</a></span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span>, <span class="fu"><a href="Spectrum-class.html">intensity</a></span><span class="op">(</span><span class="va">sp2</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"darkgrey"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'object' in selecting a method for function 'mz': object 'sp2' not found</span>
<span class="r-in"><span><span class="co">## Using k = 1, closest signals</span></span></span>
<span class="r-in"><span><span class="va">sp3</span> <span class="op">&lt;-</span> <span class="fu">pickPeaks</span><span class="op">(</span><span class="va">sp1</span>, refineMz <span class="op">=</span> <span class="st">"kNeighbors"</span>, k <span class="op">=</span> <span class="fl">1</span><span class="op">)</span>           </span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> unable to find an inherited method for function ‘pickPeaks’ for signature ‘object = "Spectrum1"’</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="Spectrum-class.html">mz</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span>, <span class="fu"><a href="Spectrum-class.html">intensity</a></span><span class="op">(</span><span class="va">sp3</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"green"</span>, type <span class="op">=</span> <span class="st">"h"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'object' in selecting a method for function 'mz': object 'sp3' not found</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co">## Using descendPeak requiring at least 50% or the centroid's intensity</span></span></span>
<span class="r-in"><span><span class="va">sp4</span> <span class="op">&lt;-</span> <span class="fu">pickPeaks</span><span class="op">(</span><span class="va">sp1</span>, refineMz <span class="op">=</span> <span class="st">"descendPeak"</span>, signalPercentage <span class="op">=</span> <span class="fl">50</span><span class="op">)</span>           </span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error:</span> unable to find an inherited method for function ‘pickPeaks’ for signature ‘object = "Spectrum1"’</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="fu"><a href="Spectrum-class.html">mz</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span>, <span class="fu"><a href="Spectrum-class.html">intensity</a></span><span class="op">(</span><span class="va">sp4</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, type <span class="op">=</span> <span class="st">"h"</span><span class="op">)</span></span></span>
<span class="r-err co"><span class="r-pr">#&gt;</span> <span class="error">Error in h(simpleError(msg, call)):</span> error in evaluating the argument 'object' in selecting a method for function 'mz': object 'sp4' not found</span>
<span class="r-in"><span>           </span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.9000.</p>
</div>

    </footer></div>





  </body></html>

