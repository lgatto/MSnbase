<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Peak Detection for 'MSnExp' or 'Spectrum' instances — pickPeaks-methods • MSnbase</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="Peak Detection for 'MSnExp' or 'Spectrum' instances — pickPeaks-methods" />
<meta property="og:description" content="This method performs a peak picking on individual spectra
  (Spectrum instances) or whole experiments (MSnExp instances) to
  create centroided spectra.
  For noisy spectra there are currently two different noise estimators
  available, the Median Absolute Deviation (method = &quot;MAD&quot;) and
  Friedman's Super Smoother (method = &quot;SuperSmoother&quot;),
  as implemented in the MALDIquant::detectPeaks and
  MALDIquant::estimateNoise functions respectively.
The method supports also to optionally refine the m/z value of
  the identified centroids by considering data points that belong (most
  likely) to the same mass peak. The m/z value is calculated as an
  intensity weighted average of the m/z values within the peak region. 
  How the peak region is defined depends on the method chosen:
refineMz = &quot;kNeighbors&quot;: m/z values (and their respective
  intensities) of the2 * k closest signals to the centroid are
  used in the intensity weighted average calculation. The number of
  neighboring signals can be defined with the argument k.
refineMz = &quot;descendPeak&quot;: the peak region is defined by
  descending from the identified centroid/peak on both sides until the
  measured signal increases again. Within this defined region all
  measurements with an intensity of at least signalPercentage of
  the centroid's intensity are used to calculate the refined m/z. By
  default the descend is stopped when the first signal that is equal or
  larger than the last observed one is encountered. Setting
  stopAtTwo = TRUE, two consecutively increasing signals are
  required.  
By default (refineMz = &quot;none&quot;, simply the m/z of the largest
  signal (the identified centroid) is reported. See below for examples." />






<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MSnbase</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">2.17.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/v01-MSnbase-demo.html">MSnbase: MS data processing, visualisation and quantification</a>
    </li>
    <li>
      <a href="../articles/v02-MSnbase-io.html">MSnbase IO capabilities</a>
    </li>
    <li>
      <a href="../articles/v03-MSnbase-centroiding.html">MSnbase: centroiding of profile-mode MS data</a>
    </li>
    <li>
      <a href="../articles/v04-benchmarking.html">MSnbase benchmarking</a>
    </li>
    <li>
      <a href="../articles/v05-MSnbase-development.html">A short introduction to *MSnbase* development</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/lgatto/MSnbase/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Peak Detection for 'MSnExp' or 'Spectrum' instances</h1>
    
    <div class="hidden name"><code>pickPeaks-method.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>This method performs a peak picking on individual spectra
  (<code>Spectrum</code> instances) or whole experiments (<code>MSnExp</code> instances) to
  create centroided spectra.
  For noisy spectra there are currently two different noise estimators
  available, the Median Absolute Deviation (<code>method = "MAD"</code>) and
  Friedman's Super Smoother (<code>method = "SuperSmoother"</code>),
  as implemented in the <code><a href='https://rdrr.io/pkg/MALDIquant/man/detectPeaks-methods.html'>MALDIquant::detectPeaks</a></code> and
  <code><a href='https://rdrr.io/pkg/MALDIquant/man/estimateNoise-methods.html'>MALDIquant::estimateNoise</a></code> functions respectively.</p>
<p>The method supports also to optionally <em>refine</em> the m/z value of
  the identified centroids by considering data points that belong (most
  likely) to the same mass peak. The m/z value is calculated as an
  intensity weighted average of the m/z values within the peak region. 
  How the peak region is defined depends on the method chosen:</p>
<p><code>refineMz = "kNeighbors"</code>: m/z values (and their respective
  intensities) of the<code>2 * k</code> closest signals to the centroid are
  used in the intensity weighted average calculation. The number of
  neighboring signals can be defined with the argument <code>k</code>.</p>
<p><code>refineMz = "descendPeak"</code>: the peak region is defined by
  descending from the identified centroid/peak on both sides until the
  measured signal increases again. Within this defined region all
  measurements with an intensity of at least <code>signalPercentage</code> of
  the centroid's intensity are used to calculate the refined m/z. By
  default the descend is stopped when the first signal that is equal or
  larger than the last observed one is encountered. Setting
  <code>stopAtTwo = TRUE</code>, two consecutively increasing signals are
  required.</p>  
<p>By default (<code>refineMz = "none"</code>, simply the m/z of the largest
  signal (the identified centroid) is reported. See below for examples.</p>
    </div>



    <h2 class="hasAnchor" id="methods"><a class="anchor" href="#methods"></a>Methods</h2>

    <p></p><dl>
    <dt><code>signature(x = "MSnExp", halfWindowSize = "integer",
        method = "character", SNR = "numeric", verbose = "logical",
	refineMz = "character", ...)</code></dt><dd><p>Performs the peak picking for all spectra in an <code>MSnExp</code> instance.
      <code>method</code> could be <code>"MAD"</code> or <code>"SuperSmoother"</code>.
      <code>halfWindowSize</code> controls the window size of the peak picking
      algorithm. The resulting window size is <code>2 * halfWindowSize + 1</code>.
      The size should be nearly (or slightly larger) the <em>FWHM</em>
      (full width at half maximum).
      A local maximum is considered as peak if its intensity is <code>SNR</code>
      times larger than the estimated noise.
      <code>refineMz</code> allows to choose a method for an optional centroid
      m/z refinement (see description for more details). Choises are
      <code>"none"</code> (default, no m/z refinement), <code>"kNeighbors"</code>
      and <code>"descendPeak"</code>.
      The arguments <code>...</code> are passed to the noise estimator or
      m/z refinement functions.
      For the noise estimator functions, currenlty only the
      <code>method = "SuperSmoother"</code> accepts additional arguments,
      e.g.  <code>span</code>. Please see <code><a href='https://rdrr.io/r/stats/supsmu.html'>supsmu</a></code> for
      details. <code>refineMethod = "kNeighbors"</code> supports additional
      argument <code>k</code> and <code>refineMethod = "descendPeak"</code>
      arguments <code>signalPercentage</code> and <code>stopAtTwo</code>. See
      description above for more details.      This method displays a progress bar if <code>verbose = TRUE</code>.
      Returns an <code>MSnExp</code> instance with centroided spectra.</p></dd>
    <dt><code>signature(x = "Spectrum", method = "character",
        halfWindowSize = "integer", ...)</code></dt><dd><p>Performs the peak picking for the spectrum (<code>Spectrum</code> instance).
      This method is the same as above but returns a centroided <code>Spectrum</code>
      instead of an <code>MSnExp</code> object. It has no <code>verbose</code> argument.
      Please read the details for the above <code>MSnExp</code> method.</p></dd>
  
</dl>

    <h2 class="hasAnchor" id="author"><a class="anchor" href="#author"></a>Author</h2>

    <p>Sebastian Gibb &lt;mail@sebastiangibb.de&gt; with contributions from
  Johannes Rainer.</p>
    <h2 class="hasAnchor" id="see-also"><a class="anchor" href="#see-also"></a>See also</h2>

    <div class='dont-index'><p><code><a href='clean-methods.html'>clean</a></code>, <code><a href='removePeaks-methods.html'>removePeaks</a></code> <code><a href='smooth-methods.html'>smooth</a></code>,
  <code><a href='estimateNoise-methods.html'>estimateNoise</a></code> and <code><a href='trimMz-methods.html'>trimMz</a></code> for other spectra
  processing methods.</p></div>
    <h2 class="hasAnchor" id="references"><a class="anchor" href="#references"></a>References</h2>

    <p>S. Gibb and K. Strimmer. 2012.
MALDIquant: a versatile R package for the analysis of mass spectrometry data.
Bioinformatics 28: 2270-2271.
<a href='http://strimmerlab.org/software/maldiquant/'>http://strimmerlab.org/software/maldiquant/</a></p>

    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='va'>sp1</span> <span class='op'>&lt;-</span> <span class='fu'>new</span><span class='op'>(</span><span class='st'>"Spectrum1"</span>,
           intensity <span class='op'>=</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>, <span class='fl'>5</span><span class='op'>:</span><span class='fl'>1</span><span class='op'>)</span>,
           mz <span class='op'>=</span> <span class='fl'>1</span><span class='op'>:</span><span class='fl'>11</span>,
           centroided <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='va'>sp2</span> <span class='op'>&lt;-</span> <span class='fu'>pickPeaks</span><span class='op'>(</span><span class='va'>sp1</span><span class='op'>)</span>
<span class='fu'><a href='Spectrum-class.html'>intensity</a></span><span class='op'>(</span><span class='va'>sp2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; [1] 6</div><div class='input'>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span><span class='op'>(</span><span class='va'>itraqdata</span><span class='op'>)</span>
<span class='va'>itraqdata2</span> <span class='op'>&lt;-</span> <span class='fu'>pickPeaks</span><span class='op'>(</span><span class='va'>itraqdata</span><span class='op'>)</span>
<span class='fu'><a href='pSet-class.html'>processingData</a></span><span class='op'>(</span><span class='va'>itraqdata2</span><span class='op'>)</span>
</div><div class='output co'>#&gt; - - - Processing information - - -
#&gt; Data loaded: Wed May 11 18:54:39 2011 
#&gt; Updated from version 0.3.0 to 0.3.1 [Fri Jul  8 20:23:25 2016] 
#&gt; peak picking: MAD noise estimation and none centroid m/z refinement on spectra of MS level(s)2 [Thu Jan 21 14:01:52 2021] 
#&gt; peak picking: SuperSmoother noise estimation and kNeighbors centroid m/z refinement on spectra of MS level(s)2 [Thu Jan 21 14:01:52 2021] 
#&gt; peak picking: MAD noise estimation and kNeighbours centroid m/z refinement on spectra of MS level(s)2 [Thu Jan 21 14:01:52 2021] 
#&gt; peak picking: SuperSmoother noise estimation and descendPeak centroid m/z refinement on spectra of MS level(s)2 [Thu Jan 21 14:01:52 2021] 
#&gt; Spectra centroided: Thu Jan 21 14:01:52 2021 
#&gt;  MSnbase version: 1.1.22 </div><div class='input'>

<span class='co'>## Examples for refineMz:</span>
<span class='va'>ints</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span><span class='op'>(</span><span class='fl'>5</span>, <span class='fl'>3</span>, <span class='fl'>2</span>, <span class='fl'>3</span>, <span class='fl'>1</span>, <span class='fl'>2</span>, <span class='fl'>4</span>, <span class='fl'>6</span>, <span class='fl'>8</span>, <span class='fl'>11</span>, <span class='fl'>4</span>, <span class='fl'>7</span>, <span class='fl'>5</span>, <span class='fl'>2</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>0</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>1</span>, <span class='fl'>0</span><span class='op'>)</span>
<span class='va'>mzs</span> <span class='op'>&lt;-</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='pSet-class.html'>length</a></span><span class='op'>(</span><span class='va'>ints</span><span class='op'>)</span>
<span class='va'>sp1</span> <span class='op'>&lt;-</span> <span class='fu'>new</span><span class='op'>(</span><span class='st'>"Spectrum1"</span>, intensity <span class='op'>=</span> <span class='va'>ints</span>, mz <span class='op'>=</span> <span class='va'>mzs</span>, centroided <span class='op'>=</span> <span class='cn'>FALSE</span><span class='op'>)</span>
<span class='fu'><a href='plot-methods.html'>plot</a></span><span class='op'>(</span><span class='fu'><a href='Spectrum-class.html'>mz</a></span><span class='op'>(</span><span class='va'>sp1</span><span class='op'>)</span>, <span class='fu'><a href='Spectrum-class.html'>intensity</a></span><span class='op'>(</span><span class='va'>sp1</span><span class='op'>)</span>, type <span class='op'>=</span> <span class='st'>"h"</span><span class='op'>)</span>
</div><div class='input'>
<span class='co'>## Without m/z refinement:</span>
<span class='va'>sp2</span> <span class='op'>&lt;-</span> <span class='fu'>pickPeaks</span><span class='op'>(</span><span class='va'>sp1</span><span class='op'>)</span>           
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='fu'><a href='Spectrum-class.html'>mz</a></span><span class='op'>(</span><span class='va'>sp2</span><span class='op'>)</span>, <span class='fu'><a href='Spectrum-class.html'>intensity</a></span><span class='op'>(</span><span class='va'>sp2</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"darkgrey"</span><span class='op'>)</span>
</div><div class='input'><span class='co'>## Using k = 1, closest signals</span>
<span class='va'>sp3</span> <span class='op'>&lt;-</span> <span class='fu'>pickPeaks</span><span class='op'>(</span><span class='va'>sp1</span>, refineMz <span class='op'>=</span> <span class='st'>"kNeighbors"</span>, k <span class='op'>=</span> <span class='fl'>1</span><span class='op'>)</span>           
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='fu'><a href='Spectrum-class.html'>mz</a></span><span class='op'>(</span><span class='va'>sp3</span><span class='op'>)</span>, <span class='fu'><a href='Spectrum-class.html'>intensity</a></span><span class='op'>(</span><span class='va'>sp3</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"green"</span>, type <span class='op'>=</span> <span class='st'>"h"</span><span class='op'>)</span>
</div><div class='input'>
<span class='co'>## Using descendPeak requiring at least 50% or the centroid's intensity</span>
<span class='va'>sp4</span> <span class='op'>&lt;-</span> <span class='fu'>pickPeaks</span><span class='op'>(</span><span class='va'>sp1</span>, refineMz <span class='op'>=</span> <span class='st'>"descendPeak"</span>, signalPercentage <span class='op'>=</span> <span class='fl'>50</span><span class='op'>)</span>           
<span class='fu'><a href='https://rdrr.io/r/graphics/points.html'>points</a></span><span class='op'>(</span><span class='fu'><a href='Spectrum-class.html'>mz</a></span><span class='op'>(</span><span class='va'>sp4</span><span class='op'>)</span>, <span class='fu'><a href='Spectrum-class.html'>intensity</a></span><span class='op'>(</span><span class='va'>sp4</span><span class='op'>)</span>, col <span class='op'>=</span> <span class='st'>"red"</span>, type <span class='op'>=</span> <span class='st'>"h"</span><span class='op'>)</span>
</div><div class='img'><img src='pickPeaks-method-1.png' alt='' width='700' height='433' /></div><div class='input'>           
</div></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Laurent Gatto, Johannes Rainer, Sebastian Gibb.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


